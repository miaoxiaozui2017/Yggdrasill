## DataTransform

任务：抽象数据传输层
# 原理说明
底层使用封装后的Socket\Serial\Can原始数据流。  
将数据传输统一为Send和Recv，建立连接的监听方作为Server，发起方作为Client。

# 关于Protocol定义
* 决定通信由哪个程序发起以及响应时间何时产生

# 关于Server/Client定义
* Server: 一般只响应客户端请求，仅在复杂的网络通信中使用异步回调（由服务器向客户发起请求）
* Client: 一般通信由客户发起请求

# 关于Serial类定义
* Serial类封装RS232接口数据读写操作
* 支持Linux操作系统
* 支持Windows操作系统
* 接口定义细节
  1. 打开端口
  2. 配置端口
  3. 发送数据（写）
  4. 接收数据（读）
  5. 关闭端口
* 接口实现注意事项
  1. 通讯错误抛出异常（暂无解决方案）
     * 打开错误
     * 发送错误（EIO：DCD信号线断开）
     * 读取错误（超时/错误）
  2. 配置端口
     * 串口名称
     * 波特率
     * 格式
     * 是否阻塞
     * 预留其他备选配置
  3. 发送数据
     * 发送结果检查
  4. 接收数据
     * 接收结果检查与校验
     * 完整性拼接

# SerialConfig.json配置文件定义

```
{
  "serialName" : "/dev/ttyS0",
  "speed" : 2400,
  "databits" : 8,
  "parity" : "N",
  "stopbits" : 1,
  "isBlocked" : false
}
```

# Socket开发计划
* TCP/IP协议支持
* UDP/IP协议支持
* 多链接请求接受支持
* 自定义协议支持

# TCP客户端定义
* 定义传输层协议：TCP/IP
* 定义职责：主动连接服务器并主动发送请求或主动接收服务器应答
* 数据定义：字节流
* 配置定义：服务器IP、端口号、阻塞式或非阻塞式、传输层定义TCP
* 通信规范：
  1. 若服务器采用请求应答，则客户端应主动发送请求
  2. 若服务器采用主动应答，则客户端应主动接收应答
  3. 客户端应主动执行close()调用，发送断开连接请求（需测试服务器端Send函数是否返回0）

# TCP服务器定义
* 定义传输层协议：TCP/IP
* 定义职责：被动接收客户端的连接请求并根据协议返回服务器应答
* 数据定义：字节流
* 配置文件：服务器端口号、阻塞式或非阻塞式、传输层定义TCP、是否主动发送应答（可选）、考虑在xinetd守护进程上托管配置文件
* 通信规范：
  1. 若服务器定义为主动应答，则应在客户端连接服务器后主动发送数据
  2. 若服务器定义为请求应答，则应在客户建立连接后立刻准备接受请求，并给予正确应答
  3. 服务器应主动处理客户端的close()请求，若发现客户端发送断开连接请求，则服务器端应停止继续发送数据并立刻关闭链接

# TCP通信协议开发规范
* 自定义通信协议时，应继承基础TCP客户端或TCP服务器基类并按通信协议规范重写Recv和Send函数，在经过严格测试后部署
* 根据应用制定协议通信规范，内容包括请求字段定义、应答字段定义、请求应答内容映射、控制请求定义
* TCP协议原则上不需要接受方手动响应ACK
* TCP协议支持KeepAlive，按需配置测试使用

# UDP节点定义
* 定义传输层协议：UDP/IP
* UDP协议特性：UDP协议下任何节点都可以作为客户端或服务器，不需要监听特定端口号，不需要与对方建立链接，拥有多播广播能力，不能保证数据到达，不能保证到达顺序
* 定义职责：节点间消息传递工作、广播多播工作、自定义应答帧实现稳定链路通信
* 数据定义：数据报
* 配置定义：接受端IP（或广播）、端口号、阻塞式或非阻塞式、传输层定义UDP
* 通信规范：
  1. 若与UDP输出端为主动发送，则输入端应主动接收来自输出端的全部报文，并根据协议规范实现帧序调整
  2. 若与UDP输出端为请求发送，则输入端应主动发送请求并主动接受回传数据，数据内容可以是业务数据也可以是ACK应答帧
  3. 若使用UDP广播多播特性，则应按照广播和多播协议编程规范执行
  4. 若使用UDP建立稳定链路传输协议，则应在每个UDP节点发送方发送数据后立刻接收ACK应答帧，接受端接受数据后立刻发送ACK应答帧
  5. 若使用UDP建立高级链路传输协议，应考虑引入滑动窗口协议和流量控制等技术，强烈建议使用TCP/IP取代UDP

# SCTP协议探索开发
* 定义传输层协议：SCTP/IP
* SCTP协议为较新的协议，待研究
